<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test Gen | Dev·stopian</title>
    
    
    <meta name="description" content="Decouple the your test from source.">
    
    
    <meta name="keywords" content="Testing, Rust">
    
    
    <link rel="canonical" href="https:&#x2F;&#x2F;devstopian.com&#x2F;blog&#x2F;2019-04-06-test-gen&#x2F;" />
    
    <link rel="stylesheet" href="https://devstopian.com/style.css">
    
  </head>
  <body class="theme-tokiostopian">
    
    <header>
      <nav>
        <a href="/">/home/</a>

        
        
        
        <a href="https:&#x2F;&#x2F;devstopian.com&#x2F;blog&#x2F;">&#x2F;blog&#x2F;</a>
        

        
        
        <a href="https:&#x2F;&#x2F;devstopian.com&#x2F;about&#x2F;">&#x2F;about&#x2F;</a>
        
      </nav>
    </header>
    <hr>
    <main>
      
<section>
  <h1>Test Gen</h1>
  
  <p>Originally Published: <time>2019-04-06</time></p>
  
  
  <p class="tags">
  Tags: [
  
  <a href="https://devstopian.com/tags/testing/">#Testing</a>, 
  
  <a href="https://devstopian.com/tags/rust/">#Rust</a>
  
  ]
    <hr />
  </p>
  
  <div>
    <p>One of the primary goals of each unit test is to ensure that the test code is as decoupled from the source code as possible. Ideally, you want to be able to make a change to the production code and only have tests that fail that code change.</p>
<h2 id="the-problem">The Problem</h2>
<p>Let's setup some code to show the problem. Given the following production code:</p>
<pre class="giallo" style="color: #CDD6F4; background-color: #1E1E2E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #9399B2;font-style: italic;">// cargo add uuid --features v4</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">use</span><span style="color: #F9E2AF;"> uuid</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Uuid</span><span style="color: #9399B2;">;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">#</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">derive</span><span style="color: #9399B2;">(</span><span style="color: #F9E2AF;font-style: italic;">Debug</span><span style="color: #9399B2;">,</span><span style="color: #F9E2AF;font-style: italic;"> Clone</span><span style="color: #9399B2;">,</span><span style="color: #F9E2AF;font-style: italic;"> PartialEq</span><span style="color: #9399B2;">,</span><span style="color: #F9E2AF;font-style: italic;"> Eq</span><span style="color: #9399B2;">)]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">pub enum</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    Senator</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    Jedi</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    Sith</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">#</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">derive</span><span style="color: #9399B2;">(</span><span style="color: #F9E2AF;font-style: italic;">Debug</span><span style="color: #9399B2;">,</span><span style="color: #F9E2AF;font-style: italic;"> Clone</span><span style="color: #9399B2;">)]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">pub struct</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    pub</span><span> id</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Uuid</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    pub</span><span> role</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #CBA6F7;">pub fn</span><span style="color: #89B4FA;font-style: italic;"> is_sith_lord</span><span style="color: #9399B2;">(</span><span style="color: #EBA0AC;">character</span><span style="color: #94E2D5;">: &amp;</span><span style="color: #F9E2AF;font-style: italic;">Character</span><span style="color: #9399B2;">)</span><span style="color: #94E2D5;"> -&gt;</span><span style="color: #F9E2AF;font-style: italic;"> bool</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>    character</span><span style="color: #94E2D5;">.</span><span>role </span><span style="color: #94E2D5;">==</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Sith</span></span>
<span class="giallo-l"><span style="color: #9399B2;">}</span></span></code></pre>
<p>Let's say that we want to create few tests verifying the role of the character.</p>
<pre class="giallo" style="color: #CDD6F4; background-color: #1E1E2E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">#</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">cfg</span><span style="color: #9399B2;">(</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">)]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">mod</span><span style="color: #FAB387;"> tests</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    use super</span><span style="color: #94E2D5;">::*</span><span style="color: #9399B2;">;</span></span>
<span class="giallo-l"><span>    </span></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    #</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    fn</span><span style="color: #89B4FA;font-style: italic;"> sith_character_is_sith</span><span style="color: #9399B2;">() {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">        let</span><span> character</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>            id</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Uuid</span><span style="color: #94E2D5;">::</span><span style="color: #89B4FA;font-style: italic;">new_v4</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            role</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Sith</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">        };</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">        assert!</span><span style="color: #9399B2;">(</span><span style="color: #89B4FA;font-style: italic;">is_sith_lord</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">&amp;</span><span>character</span><span style="color: #9399B2;">));</span></span>
<span class="giallo-l"><span style="color: #9399B2;">    }</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    #</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    fn</span><span style="color: #89B4FA;font-style: italic;"> senator_character_is_not_sith</span><span style="color: #9399B2;">() {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">        let</span><span> character</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>            id</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Uuid</span><span style="color: #94E2D5;">::</span><span style="color: #89B4FA;font-style: italic;">new_v4</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            role</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Senator</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">        };</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">        assert!</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">!</span><span style="color: #89B4FA;font-style: italic;">is_sith_lord</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">&amp;</span><span>character</span><span style="color: #9399B2;">));</span></span>
<span class="giallo-l"><span style="color: #9399B2;">    }</span></span>
<span class="giallo-l"><span style="color: #9399B2;">}</span></span></code></pre>
<p>What happens when we want to add a few extra fields to our <code>Character</code> struct?</p>
<pre class="giallo" style="color: #CDD6F4; background-color: #1E1E2E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">#</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">derive</span><span style="color: #9399B2;">(</span><span style="color: #F9E2AF;font-style: italic;">Debug</span><span style="color: #9399B2;">,</span><span style="color: #F9E2AF;font-style: italic;"> Clone</span><span style="color: #9399B2;">)]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">pub struct</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    pub</span><span> id</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Uuid</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    pub</span><span> firstname</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> String</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    pub</span><span> lastname</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> String</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    pub</span><span> role</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">}</span></span></code></pre>
<p>Now, the compiler is complaining that the characters constructed in the tests don't have the fields.</p>
<pre class="giallo" style="color: #CDD6F4; background-color: #1E1E2E;"><code data-lang="shellscript"><span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">cargo</span><span style="color: #A6E3A1;"> test</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">   Compiling</span><span style="color: #A6E3A1;"> playground v0.1.0</span><span> (/home/joel/git/devstopian/drafts/playground/rs)</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">error[E0063]:</span><span style="color: #A6E3A1;"> missing fields</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">firstname</span><span style="color: #94E2D5;">`</span><span style="color: #89B4FA;font-style: italic;"> and</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">lastname</span><span style="color: #94E2D5;">`</span><span> in initializer of </span><span style="color: #94E2D5;">`</span><span style="color: #89B4FA;font-style: italic;">Character</span><span style="color: #94E2D5;">`</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">  --</span><span>&gt;</span><span style="color: #A6E3A1;"> src/main.rs:28:25</span></span>
<span class="giallo-l"><span style="color: #94E2D5;">   |</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">28</span><span style="color: #94E2D5;"> |</span><span style="color: #F38BA8;font-style: italic;">         let</span><span style="color: #A6E3A1;"> character = Character {</span></span>
<span class="giallo-l"><span style="color: #94E2D5;">   |</span><span style="color: #89B4FA;font-style: italic;">                         ^^^^^^^^^</span><span style="color: #A6E3A1;"> missing</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">firstname</span><span style="color: #94E2D5;">`</span><span style="color: #89B4FA;font-style: italic;"> and</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">lastname</span><span style="color: #94E2D5;">`</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">error[E0063]:</span><span style="color: #A6E3A1;"> missing fields</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">firstname</span><span style="color: #94E2D5;">`</span><span style="color: #89B4FA;font-style: italic;"> and</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">lastname</span><span style="color: #94E2D5;">`</span><span> in initializer of </span><span style="color: #94E2D5;">`</span><span style="color: #89B4FA;font-style: italic;">Character</span><span style="color: #94E2D5;">`</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">  --</span><span>&gt;</span><span style="color: #A6E3A1;"> src/main.rs:37:25</span></span>
<span class="giallo-l"><span style="color: #94E2D5;">   |</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">37</span><span style="color: #94E2D5;"> |</span><span style="color: #F38BA8;font-style: italic;">         let</span><span style="color: #A6E3A1;"> character = Character {</span></span>
<span class="giallo-l"><span style="color: #94E2D5;">   |</span><span style="color: #89B4FA;font-style: italic;">                         ^^^^^^^^^</span><span style="color: #A6E3A1;"> missing</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">firstname</span><span style="color: #94E2D5;">`</span><span style="color: #89B4FA;font-style: italic;"> and</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">lastname</span><span style="color: #94E2D5;">`</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">For</span><span style="color: #A6E3A1;"> more information about this error, try</span><span style="color: #94E2D5;"> `</span><span style="color: #89B4FA;font-style: italic;">rustc</span><span style="color: #A6E3A1;"> --explain E0063</span><span style="color: #94E2D5;">`</span><span style="color: #F38BA8;font-style: italic;">.</span></span></code></pre>
<p>Each of the tests will need to be updated <em><strong>even though they have nothing to do with the new fields.</strong></em></p>
<pre class="giallo" style="color: #CDD6F4; background-color: #1E1E2E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">#</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">cfg</span><span style="color: #9399B2;">(</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">)]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">mod</span><span style="color: #FAB387;"> tests</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    use super</span><span style="color: #94E2D5;">::*</span><span style="color: #9399B2;">;</span></span>
<span class="giallo-l"><span>    </span></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    #</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    fn</span><span style="color: #89B4FA;font-style: italic;"> sith_character_is_sith</span><span style="color: #9399B2;">() {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">        let</span><span> character</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>            id</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Uuid</span><span style="color: #94E2D5;">::</span><span style="color: #89B4FA;font-style: italic;">new_v4</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            firstname</span><span style="color: #94E2D5;">:</span><span style="color: #A6E3A1;"> &quot;Darth&quot;</span><span style="color: #94E2D5;">.</span><span style="color: #89B4FA;font-style: italic;">to_string</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            lastname</span><span style="color: #94E2D5;">:</span><span style="color: #A6E3A1;"> &quot;Sidious&quot;</span><span style="color: #94E2D5;">.</span><span style="color: #89B4FA;font-style: italic;">to_string</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            role</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Sith</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">        };</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">        assert!</span><span style="color: #9399B2;">(</span><span style="color: #89B4FA;font-style: italic;">is_sith_lord</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">&amp;</span><span>character</span><span style="color: #9399B2;">));</span></span>
<span class="giallo-l"><span style="color: #9399B2;">    }</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    #</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    fn</span><span style="color: #89B4FA;font-style: italic;"> senator_character_is_not_sith</span><span style="color: #9399B2;">() {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">        let</span><span> character</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>            id</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Uuid</span><span style="color: #94E2D5;">::</span><span style="color: #89B4FA;font-style: italic;">new_v4</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            firstname</span><span style="color: #94E2D5;">:</span><span style="color: #A6E3A1;"> &quot;Padmé&quot;</span><span style="color: #94E2D5;">.</span><span style="color: #89B4FA;font-style: italic;">to_string</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            lastname</span><span style="color: #94E2D5;">:</span><span style="color: #A6E3A1;"> &quot;Amidala&quot;</span><span style="color: #94E2D5;">.</span><span style="color: #89B4FA;font-style: italic;">to_string</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            role</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Senator</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">        };</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">        assert!</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">!</span><span style="color: #89B4FA;font-style: italic;">is_sith_lord</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">&amp;</span><span>character</span><span style="color: #9399B2;">));</span></span>
<span class="giallo-l"><span style="color: #9399B2;">    }</span></span>
<span class="giallo-l"><span style="color: #9399B2;">}</span></span></code></pre>
<p>The changes to the tests are accurate to the characters in the story, but they are not relevant to the function being tested. It is irrelevant to the <code>is_sith_lord</code> function whether you are testing a character named "Padmé", for example.</p>
<p>As the complexity grows in the codebase, it may become less apparent that particular datapoints in tests are irrelevant. The reader will need to reason about the purpose of the test and whether the string <code>"Padmé"</code> is relevant, for example.</p>
<h2 id="enter-gen">Enter Gen</h2>
<p>A better way to implement the tests is to put your constructed objects behind generators.</p>
<pre class="giallo" style="color: #CDD6F4; background-color: #1E1E2E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">#</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">cfg</span><span style="color: #9399B2;">(</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">)]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">mod</span><span style="color: #FAB387;"> tests</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    use super</span><span style="color: #94E2D5;">::*</span><span style="color: #9399B2;">;</span></span>
<span class="giallo-l"><span>    </span></span>
<span class="giallo-l"><span style="color: #9399B2;font-style: italic;">    // Key Idea: Create a generator function.</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    pub fn</span><span style="color: #89B4FA;font-style: italic;"> gen_character</span><span style="color: #9399B2;">()</span><span style="color: #94E2D5;"> -&gt;</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">        Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>            id</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Uuid</span><span style="color: #94E2D5;">::</span><span style="color: #89B4FA;font-style: italic;">new_v4</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            firstname</span><span style="color: #94E2D5;">:</span><span style="color: #A6E3A1;"> &quot;sample_firstname&quot;</span><span style="color: #94E2D5;">.</span><span style="color: #89B4FA;font-style: italic;">to_string</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            lastname</span><span style="color: #94E2D5;">:</span><span style="color: #A6E3A1;"> &quot;sample_lastname&quot;</span><span style="color: #94E2D5;">.</span><span style="color: #89B4FA;font-style: italic;">to_string</span><span style="color: #9399B2;">(),</span></span>
<span class="giallo-l"><span>            role</span><span style="color: #94E2D5;">:</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Senator</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #9399B2;">        }</span></span>
<span class="giallo-l"><span style="color: #9399B2;">    }</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    #</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    fn</span><span style="color: #89B4FA;font-style: italic;"> sith_character_is_sith</span><span style="color: #9399B2;">() {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">        let</span><span> character</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>            role</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Sith</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #94E2D5;">            ..</span><span style="color: #89B4FA;font-style: italic;">gen_character</span><span style="color: #9399B2;">()</span></span>
<span class="giallo-l"><span style="color: #9399B2;">        };</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">        assert!</span><span style="color: #9399B2;">(</span><span style="color: #89B4FA;font-style: italic;">is_sith_lord</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">&amp;</span><span>character</span><span style="color: #9399B2;">));</span></span>
<span class="giallo-l"><span style="color: #9399B2;">    }</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F9E2AF;font-style: italic;">    #</span><span style="color: #9399B2;">[</span><span style="color: #F9E2AF;font-style: italic;">test</span><span style="color: #9399B2;">]</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">    fn</span><span style="color: #89B4FA;font-style: italic;"> senator_character_is_not_sith</span><span style="color: #9399B2;">() {</span></span>
<span class="giallo-l"><span style="color: #CBA6F7;">        let</span><span> character</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Character</span><span style="color: #9399B2;"> {</span></span>
<span class="giallo-l"><span>            role</span><span style="color: #94E2D5;"> =</span><span style="color: #F9E2AF;font-style: italic;"> Role</span><span style="color: #94E2D5;">::</span><span style="color: #F9E2AF;font-style: italic;">Senator</span><span style="color: #9399B2;">,</span></span>
<span class="giallo-l"><span style="color: #94E2D5;">            ..</span><span style="color: #89B4FA;font-style: italic;">gen_character</span><span style="color: #9399B2;">()</span></span>
<span class="giallo-l"><span style="color: #9399B2;">        };</span></span>
<span class="giallo-l"><span style="color: #89B4FA;font-style: italic;">        assert!</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">!</span><span style="color: #89B4FA;font-style: italic;">is_sith_lord</span><span style="color: #9399B2;">(</span><span style="color: #94E2D5;">&amp;</span><span>character</span><span style="color: #9399B2;">));</span></span>
<span class="giallo-l"><span style="color: #9399B2;">    }</span></span>
<span class="giallo-l"><span style="color: #9399B2;">}</span></span></code></pre>
<p>Now, the <code>gen_character</code> function would be the only place needed to be updated or any test that directly relates to the changes. The complexity of the tests above is reduced ever so slightly, but you could imaging in a much larger codebase with 1000s of tests that this could be a huge reduction in complexity!</p>
<h2 id="update-log">Update Log</h2>
<blockquote>
<p>Updated 2026-02</p>
</blockquote>
<p>I upgraded the post from F# to Rust. F# was my primary language in 2019. I borrowed the idea of abstracting construction behind generators from the Haskell community and functional programming at large. The idea translates nicely into Rust with its spread syntax (e.g. <code>..gen_character()</code>).</p>

  </div>
</section>

    </main>
    <hr>
    <footer>
      <!-- <p>Powered by <a href="https://www.getzola.org/">Zola</a> and inspired by the <a href="https://github.com/mxaddict/zolanight">ZolaNight Theme</a></p>
       -->
    </footer>
  </body>
</html>
